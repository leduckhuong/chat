const axios = require('axios');
const getLanguageUtil = require('../utils/getLanguage.util');

class Exploit {
    async index (req, res) {
        let langCode = req.cookies.userLang;
        let languages = await getLanguageUtil(langCode);
        const host = req.protocol + '://' + req.get('host');
        if(req.query.target) {
            const exploitData = req.query;
            const exploitUrl = `${host}/exploit/exploit-start/?target=${exploitData.target}&head=${exploitData.head}&${exploitData.data}`;
            return res.render('index', {
                languages,
                isExploit: true,
                exploitData,
                exploitUrl
            });
        }
        return res.render('index', {
            languages,
            isExploit: true
        });
    }
    exploit (req, res) {
        const { target, head, ...exploitData } = req.query;

        res.render('exploit', {
            target,
            exploitData
        });
    }
}

module.exports = new Exploit();